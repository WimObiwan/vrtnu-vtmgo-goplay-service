import groovy.transform.Field

@Lazy @Field def localProperties = loadFromFile('local.properties')

@Field def knownBrands = ["vrtnu", "vtmgo", "vier"]
@Field def knownKeys = ["username", "password"]

def readAuthenticationTokens(final Test testLambda) {
    for (def brand in knownBrands)  {
        for (def key in knownKeys) {
            def propertyKeyName = "$brand.$key"
            def propertyValue = localProperties.getProperty(propertyKeyName)

            println("$propertyKeyName -> $propertyValue")
            testLambda.systemProperty propertyKeyName, propertyValue
        }
    }
}

private def loadFromFile(String fileName) {
    Properties properties = new Properties()
    def releaseFile = project.rootProject.file(fileName)
    if (releaseFile.exists()) {
        properties.load(releaseFile.newDataInputStream())
    }
    return properties
}

ext {
    addAuthenticationTokensToSystemEnv = this.&readAuthenticationTokens
}
